# 소프트웨어 개발 보안 설계
## 소프트웨어 개발 보안 설계
- SW 개발 보안 : 소스코드 등에 존재하는 보안 취약점을 제거하고, 보안을 고려하여 기능을 설계 및 구현하는 등 소프트웨어 개발 과정에서 지켜야 할 일련의 보안 활동을 말한다.

- SW 개발 보안 생명주기
요구사항 명세 : 요구사항 중 보안 항목 식별, 요구사항 명세서
설계 : 위협원 도출을 위한 위협 모델링, 보안 설계 검토 및 보안 설계서 작성, 보안 통제 수립
구현 : 표준 코딩 정의서 및 SW 개발 보안 가이드를 준수해 개발, 소스코드 보안 약점 진단 및 개선
테스트 : 모의 침투 테스트 또는 동적 분석을 통한 취약점 진단, 개선
유지보수 : 지속적인 개선, 보안패치

- __SW 개발 보안의 3대 요소
기밀성 : 인가되지 않은 개인 혹은 시스템 접근에 따른 정보 공개 및 노출을 차단하는 특성
가용성 : 권한을 가진 사용자나 애플리케이션이 원하는 서비스를 지속 사용할 수 있도록 보장하는 특성
무결성 : 정당한 방법을 따르지 않고선 데이터가 변경될 수 없으며, 데이터의 정확성 및 완전성과 고의/악의로 변경되거나 훼손 또는 파괴되지 않음을 보장하는 특성__

- __SW 개발 보안 용어
자산 (Assets) : 조직의 데이터 또는 조직의 소유자가 가치를 부여한 대상
위협 (Threat) : 조직이나 기업의 자산에 악영향을 끼칠 수 있는 사건,행위
취약점 (Vulnerability) : 위협이 발생하기 위한 사전 조건에 따른 상황
위험 (Risk) : 위협이 취약점을 이용하여 조직의 자산 손실 피해를 가져올 가능성__

### 공격 기법의 이해
- __DoS 공격 (Denial of Service)
시스템을 악의적으로 공격해 해당 시스템의 자원을 부족하게 하여 원래 의도된 용도로 사용하지 못하게 하는 공격
특정 서버에 수많은 접속시도를 만들어 다른 사용자가 정상적으로 서비스 이용을 못하게 하거나, 서버의 TCP 연결을 소진시키는 등의 공격__

- DoS공격의 종류
지역 시스템 공격 : 실제 대상 시스템에 접근하여 서버 하드웨어에 직접 과부하를 주는 공격 ex) 메모리 고갈, 프로세스 서비스 거부, 디스크 서비스 거부 등
원격 네트워크 공격 : 공격자가 목표 시스템에 접근하지 않고 원격지에서 인터넷 등을 이용한 공격 서비스를 제공받지 못하거나 실제 시스템에 영향

- DDoS 공격 (Distributed DoS)
DoS의 또 다른 형태로, 여러 대의 공격자를 분산 배치하여 동시에 동작하게 함으로써 특정 사이트를 공격하는 기법
해커들이 취약한 인터넷 시스템에 대한 액세스가 이루어지면, 침입한 시스템에 소프트웨어를 설치하고 이를 실행 시켜 원격에서 공격을 개시한다.

- DDoS 공격 구성요소
핸들러 : 마스터 시스템의 역할을 수행하는 프로그램
에이전트 : 공격 대상에 직접 공격을 가하는 시스템
마스터 : 공격자에게서 직접 명령을 받는 시스템, 여러 대의 에이전트를 관리
공격자 : 공격을 주도하는 해커의 컴퓨터
데몬 프로그램 : 에이전트 시스템의 역할을 수행하는 프로그램

- DDoS 공격의 대응 방안
차단 정책 업데이트 : 가용성이 침해될 수 있는 지점을 확인 및 데이터 기반 차단 정책 업데이트
좀비 PC IP 확보 : 공격자는 대부분 Source IP를 위조하므로 IP위변조 여부를 확인하는 절차 필요
보안 솔루션 운영 : 방화벽, 침입 탐지 시스템 등의 보안 솔루션 운영
홈페이지 보안 관리 : 모의해킹 등을 수행
시스템 패치 : 시스템 취약점을 패치를 통해 해결
---

- __자원 고갈 공격
서버간 핸드셰이크를 통해 통신이 연결되는 정상 트래픽과 달리 DoS공격은 정상 접속을 시도하는 오픈된 소켓에 트래픽을 집중시킨다.
공격이 임계치에 도달하면 사용자들은 네트워크에 전혀 접속할 수 없게된다.__


- 자원 고갈 공격 기법
SYN 플러딩 : TCP 프로토콜 구조적 문제를 이용, SYN 패킷만 보내 사용자 수를 점유, 다른 사용자가 사용할 수 없게 함, 공격자는 ACK를 발송하지 않고 새로운 연결 요청만 함. 서버는 자원할당을 해지하지 않고 자원만 소비하여 자원이 고갈.
LDP 플러딩 : 대량의 UDP 패킷을 만들어 임의의 포트 번호로 전송, 응답 메시지를 생성하게 하여 지속해서 자원을 고갈시키는 공격, ICMP 패킷은 변조되어 공격자에게 전달되지 않아 대기함.
스머프 : 출발지 주소를 공격 대상의 IP로 설정하여 네트워크 전체에게 ICMP Echo패킷을 직접 브로드캐스팅하여 마비시키는 공격, 바운스 사이트라고 불리는 제 3의 사이트를 이용해 공격.
PoD : 큰 사이즈의 패킷을 의도적으로 목표시스템으로 발생시켜 시스템이 서비스할 수 없는 상태로 만드는 공격

---

- 애플리케이션 공격
HTTP GET 플러딩 : Cache Control Attack 공격, Http 캐시 옵션을 조작하여 캐싱서버가 아닌 웹서버가 직접 처리하도록 유도, 웹 서버 자원을 소진시키는 서비스 거부 공격
Slowloris : HTTP GET 메소드를 사용, 헤더의 최종 끝을 알리는 개행 문자열인 \r\n\r\n을 전송하지 않고, \r\n만 전송하여 웹서버와 연결상태를 장시간 지속, 연결 자원을 모두 소진시키는 서비스 거부 공격.
RUDY : 요청 헤더의 Content-length를 비정상적으로 크게 설정하여 메시지 바디부분을 매우 소량으로 보내 계속 연결 상태를 유지시키는 공격
---

- 네트워크 서비스 공격
네트워크 스캐너, 스니퍼 : 네트워크 하드웨어 및 소프트웨어 구성의 취약점 파악을 위해 공격자가 사용하는 공격 도구
패스워드 크래킹 : 사전 크래킹과 무차별 크래킹 방법을 사용해 네트워크 패스워드를 탐색
IP 스푸핑 : 서버에 대한 인증되지 않은 액세스 권한을 입수하는 데 사용하는 기법, 침입자가 패킷 헤더 수정을 통해 인증된 호스트의 IP 어드레스를 위조, 타깃 서버로 메시지를 발송한 이후, 패킷은 해당 포트에서 유입되는 것처럼 표시
트로이 목마 : 악성 루틴이 숨어 있는 프로그램으로서 겉보기에는 정상적인 프로그램처럼 보이지만 실행하면 악성코드를 실행

---

- 취약점 공격
랜드 어택 : 출발지 IP와 목적지 IP를 같은 패킷 주소로 만들어 보냄으로써 수신자가 자기 자신에게 응답을 보내게하여 시스템의 가용성을 침해하는 공격기법
봉크/ 보잉크 : 프로토콜의 오류 제어를 이용한 기법, 시스템의 패킷 재전송과 재조립이 과부하를 유발.
봉크 : 같은 시퀀스 번호를 계속 보냄
보잉크 : 일정한 간격으로 시퀀스 번호에 빈공간 생성
티어 드롭 : IP 패킷 재조합과정에서 잘못된 Fragment Offset 정보로 인해 수신시스템이 문제를 발생하도록 만드는 DoS공격, 공격자는 IP Fragment Offset 값을 서로 중첩되도록 조작하여 전송하고, 이를 수신한 시스템이 재조합하는 과정에서 오류가 발생, 시스템의 기능을 마비시키는 공격 방식
---

### SW 개발 보안을 위한 암호화 알고리즘
- 암호알고리즘 : 데이터의 무결성 및 기밀성 확보를 위해 정보를 쉽게 해독할 수 없는 형태로 변환하는 기법

#### 암호 알고리즘 방식
- 대칭키 암호 방식
__블록 암호 방식 : 긴 평문을 암호화하기 위해 고정 길이의 블록을 암호화하는 블록 암호 알고리즘을 반복하는 기법__
ex) DES, AES, SEED
DES : 64비트 평문블록을 64비트 암호문 블록으로 만드는 미국표준 암호화 알고리즘
AES : 고급 암호화 표준, 암호화와 복호화 고정에서 동일한 키를 사용하는 대칭 키 암호화 알고리즘
SEED : KISA, ETRI 개발, 고속 블록 단위의 128비트 대칭 키 암호화 알고리즘
__스트링 암호 방식 : 매우 긴 주기의 난수열을 발생시켜 평문과 더불어 암호문을 생성 하는 방식__

- __비대칭 키 암호 방식
공개 키를 이용해 암호화하고, 공개 키에 해당하는 개인 키를 이용해 복호화하는 암호 방식__
공개 키와 개인 키가 존재하며, 공개 키는 누구나 할 수 있으며, 개인 키는 키의 소유자만 알 수 있어야 함.
ex) 디피-헬만, RSA
Diffie-Hellman : 암호 키를 교환하는 방법, 두 사람이 암호화되지 않은 통신 망을 통해 공통의 비밀 키를 공유할 수 있도록 하는 방식
RSA : 소인수 분해의 어려움을 이용한 방식, 가장 널리 쓰임

- __해시 방식
단방향 알고리즘, 임의의 데이터를 고정된 길이의 데이터로 매핑하는 함수
해시 함수의 결과로 원본 데이터를 유추하기 어려운 것을 이용
연산에 걸리는 시간이 빠른 것이 장점, 동일한 결과를 갖는 값이 발생하는 해시 충돌 문제가 발생 가능__
ex ) SHA, MD5
SHA : 미국국가 표준으로 지정된 해시 암호화 알고리즘
MD5 : MD4를 대체하기 위해 고안한 128비트 해시 암호화 알고리즘

### 정보에 대한 보안 항목 식별
- 법률적 검토 : 내, 외부 환경 분석을 통해 보안 항목을 분석하고, 규제와 컴플라이언스 이슈 제거를 위한 사전 항목을 식별한다.

- 소프트웨어 개발 보안 활동 관련 법규 및 규정
개인정보 보호법 : 개인 정보 처리 과정상의 정보 주체와 개인 정보 처리자의 권리 의무 등 규정, 비밀번호, 바이오정보, 주민번호, 운전면허번호 등
정보통신망 이용 촉진 및 정보보호 등에 관한 법률 (정보통신망법) : 정보통신망을 통해 수집, 처리, 보관, 이용되는 개인 정보의 보호에 관한 규정, 비밀번호, 주민등록번호, 계좌번호 등
신용정보의 이용 및 보호에 관한 법률 (신용정보법) : 개인 신용정보의 취급 단계별 보호조치 및 의무사항에 관한 규정, 비밀번호, 위치정보 등

### 기능에 대한 보안 항목식별
- 각 기능을 안전하게 서비스하는 데 필요한 설계 보안 항목들을 식별한다.

- 입력데이터 검증 및 표현
사용자, 프로그램 입력 데이터에 대한 유효성 검증체계를 갖추고 실패 시 처리 할 수 있도록 설계
DBMS 조회,결과 검증 : 입력값에 대한 검증 방법 설계
XML 조회,결과 검증 : 디렉터리 서비스 조회(LDAP)시 사용되는 입력값에 대한 검증방법 설계
LDAP : 사용자 정보 유지를 위한 질의 및 디렉터리 서비스를 수정하기 위한 인터넷 프로토콜

- 세션 하이재킹 : 통신 내용을 엿보거나 세션을 가로채어 정상적인 인증 과정을 무시하고 불법으로 시스템에 접근할 수 있는 공격

### SW 개발 보안 적용 사례
- MS-SDL : 마이크로소프트는 안전한 소프트웨어를 개발하기 위해 자체 수립한 SDL 방법론을 적용
- Seven Touchpoints : 소프트웨어 보안의 모범사례를 소프트웨어 개발 라이프사이클에 통합
객관적인 위험분석 및 테스트를 거쳐 안전한 소프트웨어를 만드는 방법을 정의
수행되는 소프트웨어 위험 요소에 대해 추적하고 모니터링
- CLASP : SDLC 초기 단계에 보안 강화를 목적으로 하는 정형화된 프로세스
이미 운영 중인 시스템에 적용하기 용이

- SW 개발 보안 절차
송신 시스템 - 계획/분석 - 설계 - 구현 - 시험/검증 - 배포/운영 - 대응

# 소프트웨어 개발 보안 구현
## SW 개발 보안 구현
###시큐어 코딩 가이드
- 공격을 유발할 가능성이 있는 잠재적인 보안 취약점을 사전에 제거하고, 외부 공격으로부터 안전한 소프트웨어를 개발하는 기법
- 입력데이터 검증 및 표현 : 입력데이터에 대한 유효성 검증 체계를 수립하고 실패 시 처리 설계 및 구현
- 보안 기능 : 인증, 접근통제, 권한 관리, 비밀번호 등의 정책이 적절하게 반영되도록 설계 및 구현
- 시간 및 상태 : 공유 자원의 접근 직렬화, 병렬 실행 가능 프레임워크 사용, 블록문 내에서만 재귀함수 호출
- 에러 처리 : 중요 정보 유출 등 보안 약점이 발생하지 않도록 시스템 설계 및 구현
- 코드 오류: 경고 메시지 코드 제거
- 캡슐화 : 디버그 코드 제거와 필수 정보 외의 클래스 내 프라이빗 접근자 지정
- API 오용 : 취약 API 검출 프로그램 사용

### 입력 데이터 검증 및 표현
- SQL 삽입 : 외부 입력값이 SQL 쿼리에 삽입되어 공격
-> PreparedStatement 객체 등을 이용, DB에 컴파일 된 쿼리문(상수)를 전달
- 크로스 사이트 스크립트(XSS) : 검증되지 않은 외부 입력값에 의해 브라우저에서 악의적인 코드가 실행
-> 입,출력값에 문자열 치환 함수를 사용 &,<,>,/ 등
- 경로 조작 및 자원 삽입 : 외부 입력된 값의 사전 검증이 없거나 잘못 처리될 경우, 제공되는 시스템 자원에 접근 경로 등의 정보로 이용될 때 발생
-> 경로 순회 공격 위험이 있는 문자 제거 필터 사용 /,\,.. 등
- 운영체제 명령어 삽입 : 운영체제 명령어 파라미터 입력값이 적절한 사전 검증을 거치지 않고 사용될 때 공격자가 운영체제 명령어를 조작
-> 웹 인터페이스를 통해 내부로 시스템 명령어를 전달하지 않도록 프로그램 구성

- SQL 삽입 공격 : 웹 애플리케이션에서 입력 데이터에 대한 유효성 검증을 하지 않을 경우, 공격자가 입력창 및 URL에 SQL문을 삽입하여 DB로부터 정보를 열람, 조작할 수 있는 취약점 공격기법이다.

- 크로스 사이트 스크립트 공격 : 웹 페이지에 악의적인 스크립트를 포함해 사용자 측에서 실행되게 유도할 수 있는 공격기법이다. 검증되지 않은 외부 입력이 동적 웹페이지 생성에 사용될 경우 전송된 동적 웹페이지를 열람하는 접속자의 권한으로 부적절한 스크립트가 수행되어 정보유출 등의 공격을 유발할 수 있다.

- 보안 기능
적절한 인증 없는 중요기능 허용 : 인증과정 없이 중요 정보 등을 열람, 변경 시 발생하는 보안 약점
반복된 인증시도 제한 기능 부재 : 무차별 공격하여 로그인이 가능한 보안 약점
취약 패스워드 허용 : 보안성이 높지 않은 비밀번호의 설정을 허용

- 권한 관리 보안 약점
중요 자원에 대한 잘못된 권한 설명 : 중요자원에 대해 읽기, 수정 권한을 의도하지 않게 허가하는 경우
부적절한 인가 : 사용자에 대한 접근 권한 검사 미흡

- 암호화 보안 약점
취약 암호화 알고리즘 사용 : 비표준 알고리즘 사용 경우, 연산능력 향상으로 해독 가능한 알고리즘 사용
충분하지 않은 키 길이 사용 : 키 길이가 불충분한 경우 공격자가 짧은 시간 안에 키 발견 가능
하드코딩 된 비밀번호 : 코드 내부 하드코딩된 패스워드 사용
부적절한 난수사용 : 예측 가능한 난수를 사용할 경우
-> 난수를 발생시키는 시드 값의 고정값 대신 변경값 적용
솔트 없는 일방향 해시 함수 사용 : 솔트 없는 해시 처리 시, 레인보우 테이블을 이용해 비밀번호를 쉽게 찾을 수 있는 취약점

- 중요정보 처리 시 보안 약점
중요정보 평문 저장 : 개인정보, 인증정보 등 중요정보를 처리하는 과정에서 평문 저장
-> 저장 시 반드시 암호화 처리
중요정보 평문 전송 : 중요정보를 평문으로 송수신할 경우 발생, 통신 채널을 스니핑을 통해 민감 데이터 노출
-> 내/외부 통신 시 SSL 인증서 기반의 전송구간 암호화 적용

- 시간 및 상태 : 동시 수행을 지원하는 병렬 시스템이나 하나 이상의 프로세스가 동작하는 환경에서 시간 및 상태를 부적절하게 관리하여 발생할 수 있는 취약점
ex) 경쟁 조건, 종료되지 않는 반복문, 재귀함수 등
경쟁조건 : 메모리가 공유되는 하나의 객체에 두 개 이상의 스레드가 동시에 값을 변경하려고 할 때에 발생되는 성능저하 문제점이다.
-> 동기화 구문 mutex 사용

- 에러 처리
오류 메시지 정보 노출 : 민감 정보가 오류 메시지를 통해 노출되는 보안 약점
-> 정해진 사용자에게 유용한 최소한의 정보만 포함
오류상황 대응 부재 : 오류 발생 부분에 예외 처리 미구현
-> if-switch, try-catch 사용
부적절한 예외 처리 : 발생한 예외조건을 적절하게 검사하지 않아 문제 야기
-> 함수 결괏값의 적정성 검증, 구체적인 예외 처리 수행

- 코드 오류
널 포인터 역참조 : 널 값을 고려하지 않은 코드에서 발생하는 보안 약점, 의도적으로 널 값을 유발해 예외 상황을 확인하고 추후 공격에 활용
-> 값을 참조하기 전에 널 값인지 검사
부적절한 자원 해제 : 자원 고갈로 인한 시스템 오류 유발 보안 약점, 소켓, 힙, 메모리 등 자원을 할당받아 사용 후, 미반환 시 발생
-> 자원 획득 후 반드시 자원 해제
해제된 자원 사용 : C언어 해제한 메모리를 참조하여 의도치 않은 코드를 실행하는 보안 약점
-> 메모리 할당 해제후, 포인터에 널 값 저장
초기회되지 않은 변수 사용 : C언어 함수 내 지역변수를 초기화하지 않고 사용할 시 발생하는 보안 약점
-> 사용하기 전 초기값 할당

- 캡슐화
잘못된 세션에 의한 정보 노출 : 멀티스레드 환경에서 서로 다른 세션 간 데이터가 공유될 수 있는 보안 약점
-> 싱글톤 패턴 사용 시 변수 적용 범위 주의
제거되지 않은 디버그 코드 : 의도치 않은 민감 정보가 노출될 수 있는 보안 약점, 배포단계에서 디버그 코드가 남아있는 경우 발생
-> 소프트웨어 배포 전 디버그 코드 확인 및 삭제
시스템 정보 노출 : 시스템 내부 데이터가 노출되어 공격의 실마리가 되는 보안약점
-> 예외 상황 발생 시 시스템 내부 정보의 화면 노출이 없도록 개발

- API 오용
DNS에 의존한 보안 결정 : 공격자가 DNS 정보를 변조하여 보안 결정을 우회 가능한 보안 약점
취약한 API 사용 : 금지되거나 안전하지 않은 함수를 사용하는 보안 약점

## SW 개발 보안 테스트와 결함 관리
- 소프트웨어 개발 보안 테스트 : 소프트웨어 보안 요구사항이 반영되어 있음을 보증하고, 취약점을 발견하고 개선하여 안전한 소프트웨어를 개발하기 위한 활동이다.
- 소프트웨어 개발 보안 테스트의 유형
정적분석 : SW를 실행하지 않고 보안 약점을 분석, SW 개발 단게에서 주로 사용
-> 취약점 초기 발견으로 수정 비용 절감, 설계 구조 관점의 취약점은 식별 불가, 컴포넌트간 발생할 수 있는 통합된 취약점 발견에 제한적.

동적 분석 : SW실행환경에서 보안 약점 분석, SW 시험 단계에서 주로 사용
-> 소스코드 필요없음, 정확도와 커버리지 향상, 구조관점의 보안 약점식별 불가.

- 소프트웨어 개발 보안테스트 절차
준비 단계 : 대상선정 - 일정 수립
실행 단계 : 테스트 수행
개선 단계 : 보고서 발행, 지적사항 해결
관리 단계 : 결함 해결 사항 보고,점검된 소스코드 관리
종료 단계 : 보안 상황 보고
